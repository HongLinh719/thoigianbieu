<!DOCTYPE html>

<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Th·ªùi gian bi·ªÉu cho b√©</title>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600&amp;display=swap" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet"/>
</head>
<body>
<div class="container">
<div class="header">
<h1>Th·ªùi gian bi·ªÉu cho b√©</h1>
</div>
<div class="date-container">
<div class="date-display" id="currentDate">H√¥m nay, 17/04/2025</div>
<div class="date-nav">
<button class="date-btn" onclick="changeDate(-1)"><i class="fas fa-chevron-left"></i></button>
<button class="date-btn" onclick="changeDate(1)"><i class="fas fa-chevron-right"></i></button>
</div>
</div>
<div class="tabs">
<div class="tab active" onclick="switchTab('tridung')">Tr√≠ D≈©ng (5 tu·ªïi)</div>
<div class="tab" onclick="switchTab('thaoVy')">Th·∫£o Vy (3 tu·ªïi)</div>
</div>
<div class="progress">
<div class="progress-bar" id="progressBar" style="width: 0%">0/16 ƒëi·ªÉm</div>
</div>
<div class="child-tab" id="tridung">
<div class="sleep-record" id="sleepRecord">
<div><i class="fas fa-bed"></i> Ng·ªß ƒë√™m qua:</div>
<div id="sleepStatus">Ch∆∞a c√≥ d·ªØ li·ªáu</div>
</div>
<div class="task-list">
<!-- Tasks will be added here dynamically -->
</div>
</div>
<div class="child-tab" id="thaoVy" style="display:none">
<div class="sleep-record" id="sleepRecordThaoVy">
<div><i class="fas fa-bed"></i> Ng·ªß ƒë√™m qua:</div>
<div id="sleepStatusThaoVy">Ch∆∞a c√≥ d·ªØ li·ªáu</div>
</div>
<div class="task-list">
<!-- Tasks will be added here dynamically -->
</div>
</div>
<div class="reward" id="reward">
<i class="fas fa-trophy"></i> Ch√∫c m·ª´ng! B√© ƒë√£ ho√†n th√†nh nhi·ªám v·ª• v√† ƒë∆∞·ª£c ph√©p ch∆°i thi·∫øt b·ªã ƒëi·ªán t·ª≠ t·ª´ 20:00 - 21:00
        </div>
</div>
<div class="notification" id="notification">
<i class="fas fa-bell"></i> ƒê·∫øn gi·ªù th·ª±c hi·ªán nhi·ªám v·ª• m·ªõi!
    </div>
<button class="stats-btn" onclick="toggleStats()">
<i class="fas fa-chart-bar"></i>
</button>
<div class="stats-modal" id="statsModal">
<div class="stats-content">
<div class="stats-header">
<h2>Th·ªëng k√™ ho·∫°t ƒë·ªông</h2>
<button class="stats-close" onclick="toggleStats()"><i class="fas fa-times"></i></button>
</div>
<div class="stats-chart" id="statsChart">
<!-- Chart bars will be added here -->
</div>
<div class="stats-summary">
<h3>T√≥m t·∫Øt 7 ng√†y qua</h3>
<p><strong>T·ªïng ƒëi·ªÉm:</strong> <span id="totalPoints">0</span> ƒëi·ªÉm</p>
<p><strong>ƒêi·ªÉm trung b√¨nh:</strong> <span id="averagePoints">0</span> ƒëi·ªÉm/ng√†y</p>
<p><strong>Ng√†y t·ªët nh·∫•t:</strong> <span id="bestDay">Ch∆∞a c√≥ d·ªØ li·ªáu</span></p>
<p><strong>S·ªë ng√†y ƒë∆∞·ª£c ch∆°i thi·∫øt b·ªã:</strong> <span id="deviceDays">0</span>/7 ng√†y</p>
</div>
</div>
</div>
<div id="popup-congrats" style="display:none; position:fixed; top:30%; left:50%; transform:translate(-50%, -50%); z-index:9999; text-align:center;">
<img alt="M·∫π Qu·ª≥nh" src="images/me_quynh.jpg" style="width:250px; border-radius:10px; box-shadow: 0 0 10px #888;"/>
<div id="popup-text" style="background:white; padding:10px; font-weight:bold; font-size:18px; margin-top:-5px;">B√© l√†m t·ªët l·∫Øm!</div>
</div>
<audio id="audio-congrats" preload="auto" src=""></audio>
<img id="watering-gif" src="images/water.gif" style="display:none; position:absolute; width:120px; top:350px; left:1190px; z-index:10;"/>
<!-- TH√äM ƒêO·∫†N N√ÄY -->
<div style="position: fixed; bottom: 500px; right: 340px; text-align: center; z-index: 50;">
<img id="tree-img" src="images/tree_day1.png" style="width:150px; height:150px;"/>
<div id="tree-status" style="font-weight:bold; color:#FF9800; margin:5px 0;">
        C√¢y c·∫ßn n∆∞·ªõc ƒë·ªÉ ph√°t tri·ªÉn!
    </div>
<div style="margin-top:5px; margin-bottom:10px;">
<span id="water-count" style="font-weight:bold; color:#2196F3;">üíß <span id="water-units">0</span> l∆∞·ª£t t∆∞·ªõi</span>
</div>
<button onclick="waterTree()">üíß B√© t∆∞·ªõi n∆∞·ªõc cho c√¢y</button>
</div>
<!-- Th√™m khu v·ª±c hi·ªÉn th·ªã huy hi·ªáu -->
<div style="position: fixed; top: 100px; right: 20px; text-align: center; background-color: rgba(255,255,255,0.8); padding: 10px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
<h3 style="margin-top: 0; color: #FF6D00;">Huy hi·ªáu c·ªßa b√©</h3>
<div id="badges-container" style="display: flex; flex-wrap: wrap; justify-content: center; gap: 5px; max-width: 150px;">
<!-- Huy hi·ªáu s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y -->
</div>
</div>
<div style="position:fixed; bottom:20px; right:20px; z-index:999;">
<button onclick="resetAllData()" style="padding:10px 20px; background:red; color:white; font-weight:bold; border:none; border-radius:10px;">
    üîÑ Reset to√†n b·ªô d·ªØ li·ªáu
  </button>
</div>


<script>
// =================== C·∫§U H√åNH TO√ÄN C·ª§C ===================
let waterUnits = 0;
let treeLevel = 1;
let childLevel = { tridung: 1, thaoVy: 1 };

// =================== T∆Ø·ªöI C√ÇY ===================
function addWater(units) {
    waterUnits += units;
    const gif = document.getElementById("watering-gif");
    if (gif) {
        gif.style.display = "block";
        setTimeout(() => gif.style.display = "none", 1500);
    }
}

function waterTree() {
    if (waterUnits > 0 && treeLevel < 7) {
        treeLevel++;
        waterUnits--;
        document.getElementById("tree-img").src = `images/tree_day${treeLevel}.png`;
    }
}

// =================== CH√öC M·ª™NG & √ÇM THANH ===================
function playCongrats(taskName) {
    const messages = {
        "ƒÉn t·ªëi t·∫°i nh√†": "audio/an_toi_tai_nha.mp3",
        "v·ªá sinh c√° nh√¢n bu·ªïi t·ªëi": "audio/ve_sinh_ca_nhan_buoi_toi.mp3",
        "ƒë·ªçc s√°ch, t√¥ m√†u ho·∫∑c l√†m to√°n": "audio/doc_sach_to_mau_hoac_lam_toan.mp3",
        "ƒëi ng·ªß": "audio/di_ngu.mp3",
        "th·ª©c d·∫≠y, v·ªá sinh c√° nh√¢n, ƒëi h·ªçc": "audio/thuc_day_ve_sinh_ca_nhan_di_hoc.mp3",
        "ch∆°i t·ª± do": "audio/choi_tu_do.mp3",
        "v·ªá sinh c√° nh√¢n s√°ng": "audio/ve_sinh_ca_nhan_sang.mp3",
        "ng·ªß ƒë√™m qua": "audio/ngu_dem_qua.mp3"
    };

    const audio = new Audio(messages[taskName]);
    audio.play().catch(() => {});
    const popup = document.getElementById("popup-congrats");
    const popupText = document.getElementById("popup-text");
    popupText.innerText = `Ch√∫c m·ª´ng anh V√≠t ho√†n th√†nh t·ªët nhi·ªám v·ª•: ${taskName}`;
    popup.style.display = "block";
    setTimeout(() => popup.style.display = "none", 4500);
}

// =================== RESET TO√ÄN B·ªò ===================
function resetAllData() {
    if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën reset to√†n b·ªô d·ªØ li·ªáu kh√¥ng?")) {
        localStorage.clear();
        location.reload();
    }
}

// =================== HUY HI·ªÜU & C·∫§P ƒê·ªò ===================
let currentChild = 'tridung';

function updateLevelDisplay() {
    let disp = document.getElementById('child-level-display');
    if (!disp) {
        disp = document.createElement('div');
        disp.id = 'child-level-display';
        disp.style.position = 'fixed';
        disp.style.top = '70px';
        disp.style.left = '20px';
        disp.style.background = 'linear-gradient(45deg, #673AB7, #3F51B5)';
        disp.style.color = 'white';
        disp.style.padding = '5px 15px';
        disp.style.borderRadius = '20px';
        disp.style.fontWeight = 'bold';
        disp.style.zIndex = '999';
        document.body.appendChild(disp);
    }
    disp.innerHTML = `${currentChild === 'tridung' ? 'Tr√≠ D≈©ng' : 'Th·∫£o Vy'} - C·∫•p ${childLevel[currentChild]}`;
}

function showLevelUpNotification(oldLevel, newLevel) {
    const note = document.createElement('div');
    note.style = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:linear-gradient(45deg,#4CAF50,#8BC34A);color:white;padding:20px;border-radius:15px;box-shadow:0 5px 30px rgba(0,0,0,0.3);text-align:center;z-index:10000;';
    note.innerHTML = `
        <div style="font-size: 72px;">üéâ</div>
        <b>CH√öC M·ª™NG B√â!</b><br>B√© ƒë√£ l√™n c·∫•p!<br><br>
        <div style="font-size: 24px;">C·∫•p ${oldLevel} ‚û°Ô∏è <b style="font-size: 32px;">C·∫•p ${newLevel}</b></div>
        <div>H√£y ti·∫øp t·ª•c c·ªë g·∫Øng nh√©!</div>
        <button onclick="this.parentElement.remove()" style="margin-top:15px;padding:8px 20px;border:none;background:white;color:#4CAF50;border-radius:30px;font-weight:bold;">C·∫£m ∆°n</button>
    `;
    document.body.appendChild(note);
    new Audio('audio/firework.mp3').play().catch(() => {});
}

function checkAndUpgradeLevel(scheduleData, currentDate) {
    let points = 0;
    for (let i = 0; i < 7; i++) {
        const d = new Date(currentDate);
        d.setDate(d.getDate() - i);
        const k = d.toISOString().split('T')[0];
        if (scheduleData[currentChild]?.[k]?.totalPoints) {
            points += scheduleData[currentChild][k].totalPoints;
        }
    }
    const newLevel = Math.floor(points / 30) + 1;
    const oldLevel = childLevel[currentChild];
    if (newLevel > oldLevel) {
        childLevel[currentChild] = newLevel;
        localStorage.setItem('childLevels', JSON.stringify(childLevel));
        showLevelUpNotification(oldLevel, newLevel);
        updateLevelDisplay();
    }
}
</script>
</body>
</html>